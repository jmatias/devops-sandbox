eck-elasticsearch:
  enabled: true
  # This is adjusting the full name of the elasticsearch resource so that both the eck-elasticsearch
  # and the eck-kibana chart work together by default in the eck-stack chart.
  fullnameOverride: elasticsearch

  version: 9.0.0

  nodeSets:
    - name: default
      count: 1
      config:

        # Comment out when setting the vm.max_map_count via initContainer, as these are mutually exclusive.
        # For production workloads, it is strongly recommended to increase the kernel setting vm.max_map_count to 262144
        # and leave node.store.allow_mmap unset.
        # ref: https://www.elastic.co/guide/en/cloud-on-k8s/current/k8s-virtual-memory.html
        #
        node.store.allow_mmap: false
      volumeClaimTemplates:
        - metadata:
            name: elasticsearch-data
          spec:
            accessModes:
              - ReadWriteOnce
            resources:
              requests:
                storage: 4Gi
            storageClassName: gp2


eck-kibana:
  enabled: true

  # The following is an example of a Kibana resource that is configured to use an Ingress resource in an EKS cluster.
  #

  # Name of the Kibana instance.
  #
  fullnameOverride: kibana

  spec:
    podTemplate:
      spec:
        containers:
          - name: kibana
            env:
              - name: NODE_OPTIONS
                value: "--max-old-space-size=2048"
            resources:
              requests:
                memory: 1Gi
                cpu: 0.5
              limits:
                memory: 2.5Gi
                cpu: 2

    elasticsearchRef:
      name: elasticsearch

    config:
      server:
        publicBaseUrl: "https://kibana.tw-javier.work"


  ingress:
    enabled: true
    className: alb
    annotations:
      external-dns.alpha.kubernetes.io/hostname: kibana.tw-javier.work
      external-dns.alpha.kubernetes.io/ttl: "60"
      kubernetes.io/ingress.class: alb
      alb.ingress.kubernetes.io/scheme: internet-facing
      alb.ingress.kubernetes.io/target-type: 'ip'
      alb.ingress.kubernetes.io/group.name: "prod-external"
      alb.ingress.kubernetes.io/certificate-arn: arn:aws:acm:us-east-1:386757133934:certificate/2011e861-aed4-447e-b55c-7d3c56155d37
      alb.ingress.kubernetes.io/ssl-policy: ELBSecurityPolicy-TLS13-1-2-2021-06
      alb.ingress.kubernetes.io/listen-ports: '[{"HTTPS":443}]'
      alb.ingress.kubernetes.io/backend-protocol: "HTTPS"

    pathType: Prefix
    hosts:
      - host: "kibana.tw-javier.work"
    path: "/"
# If enabled, will use the eck-agent chart and deploy an Elastic Agent instance.
#
#eck-agent:
#  enabled: false
#
## If enabled, will use the eck-fleet-server chart and deploy a Fleet Server resource.
##
#eck-fleet-server:
#  enabled: false
#
## If enabled, will use the eck-beats chart and deploy a Beats resource.
##
eck-beats:
  enabled: true
  elasticsearchRef:
    name: elasticsearch
  kibanaRef:
    name: kibana

  name: filebeat
  version: 9.0.0
  type: filebeat
  config:
    filebeat.inputs:
      - type: filestream
        paths:
          - /var/log/containers/*.log
        parsers:
          - container: ~
        prospector:
          scanner:
            fingerprint.enabled: true
            symlinks: true
        file_identity.fingerprint: ~
    processors:
      - add_host_metadata: {}
      - add_cloud_metadata: {}
  daemonSet:
    podTemplate:
      spec:
        automountServiceAccountToken: true
        terminationGracePeriodSeconds: 30
        dnsPolicy: ClusterFirstWithHostNet
        hostNetwork: true # Allows to provide richer host metadata
        containers:
          - name: filebeat
            securityContext:
              runAsUser: 0
              # If using Red Hat OpenShift uncomment this:
              #privileged: true
            volumeMounts:
              - name: varlogcontainers
                mountPath: /var/log/containers
              - name: varlogpods
                mountPath: /var/log/pods
              - name: varlibdockercontainers
                mountPath: /var/lib/docker/containers
        volumes:
          - name: varlogcontainers
            hostPath:
              path: /var/log/containers
          - name: varlogpods
            hostPath:
              path: /var/log/pods
          - name: varlibdockercontainers
            hostPath:
              path: /var/lib/docker/containers


#
## If enabled, will use the eck-logstash chart and deploy a Logstash resource.
##
eck-logstash:
  enabled: false
#
## If enabled, will use the eck-apm-server chart and deploy a standalone APM Server resource.
##
#eck-apm-server:
#  enabled: false
#
## If enabled, will use the eck-enterprise-search chart and deploy a Enterprise Search resource.
##
#eck-enterprise-search:
#  enabled: false
